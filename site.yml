---
- name: Bootstrapping
  gather_facts: false
  hosts: all
  pre_tasks:
  - name: Check if Python is installed
  raw: command -v python
  register: python_installed
  ignore_errors: true

- name: Check if apt is installed
  raw: command -v apt
  register: apt_installed
  ignore_errors: true

- name: Bootstrap Python on Ubuntu Linux
  raw: apt update && apt install -y python
  when: python_installed|failed and apt_installed|succeeded
  become: true

- hosts: all
  vars_files:
    - "vars/main.yml"
  roles:
    - web
  environment:
    RBENV_ROOT: "{{ rbenv_home }}"
  tags:
    - web

- hosts: all
  vars_files:
    - "vars/main.yml"
  roles:
    - postgres
  tags:
    - postgres

- hosts: all
  vars_files:
    - "vars/main.yml"
  roles:
    - redis
  tags:
    - redis

- hosts: all
  vars_files:
    - "vars/main.yml"
  roles:
    - deploy
  tags:
    - deploy

- hosts: all
  vars_files:
    - "vars/main.yml"
  roles:
    - nginx
  tags:
    - nginx
